import { Builder, By, Key, until } from 'selenium-webdriver';
import { assert } from 'chai';


async function index_page_add_user_test() {
    let driver = await new Builder().forBrowser("chrome").build();

    try {
        await driver.get("http://localhost:8080/index.html");

        await driver.findElement(By.id("field_login")).sendKeys("selenium_autogen", Key.RETURN);
        await driver.findElement(By.id("field_password")).sendKeys("12345", Key.RETURN);
        await driver.findElement(By.id("field_name")).sendKeys("Selenium Autogenerated Value", Key.RETURN);
        await driver.findElement(By.id("field_balance")).sendKeys("123321123321", Key.RETURN);
        await driver.findElement(By.id("field_repS")).sendKeys("1000", Key.RETURN);
        await driver.findElement(By.id("field_repB")).sendKeys("500", Key.RETURN);
        await driver.findElement(By.id("user_add")).click();

        await new Promise(r => setTimeout(r, 1000));
        await driver.navigate().refresh();
        await new Promise(r => setTimeout(r, 1000));

        await driver.findElement(By.id("user_selenium_autogen"));
    } finally {
        await driver.quit();
    }
}

async function user_page_open_test() {
    let driver = await new Builder().forBrowser("chrome").build();

    try {
        await driver.get("http://localhost:8080/index.html");

        await driver.navigate().refresh();
        await driver.findElement(By.id("link_user_selenium_autogen")).click();
        await driver.wait(until.urlContains("user.html?selenium_autogen"), 1000);
    } finally {
        await driver.quit();
    }
}

async function user_page_return_test() {
    let driver = await new Builder().forBrowser("chrome").build();

    try {
        await driver.get("http://localhost:8080/user.html?selenium_autogen");

        await driver.findElement(By.id("go_back")).click();
        await driver.wait(until.urlMatches(/.*?index.html$/), 1000);
        await driver.findElement(By.id("link_user_selenium_autogen")).click();
        await driver.wait(until.urlContains("user.html?selenium_autogen"), 1000);
    } finally {
        await driver.quit();
    }
}

async function user_page_data_test() {
    let driver = await new Builder().forBrowser("chrome").build();

    try {
        await driver.get("http://localhost:8080/user.html?selenium_autogen");

        assert.equal(await driver.findElement(By.id("field_name")).getAttribute("value"), "Selenium Autogenerated Value");
        assert.equal(await driver.findElement(By.id("field_balance")).getAttribute("value"), "123321123321");
        assert.equal(await driver.findElement(By.id("field_repS")).getAttribute("value"), "1000");
        assert.equal(await driver.findElement(By.id("field_repB")).getAttribute("value"), "500");
    } finally {
        await driver.quit();
    }
}

async function user_page_edit_test() {
    let driver = await new Builder().forBrowser("chrome").build();

    try {
        await driver.get("http://localhost:8080/user.html?selenium_autogen");

        const field_name = await driver.findElement(By.id("field_name"));
        const field_balance = await driver.findElement(By.id("field_balance"));
        const field_repS = await driver.findElement(By.id("field_repS"));
        const field_repB = await driver.findElement(By.id("field_repB"));

        field_name.clear();
        field_balance.clear();
        field_repS.clear();
        field_repB.clear();

        field_name.sendKeys("Selenium Edited", Key.RETURN);
        field_balance.sendKeys("0", Key.RETURN);
        field_repS.sendKeys("500", Key.RETURN);
        field_repB.sendKeys("1000", Key.RETURN);

        await driver.findElement(By.id("user_edit")).click();

        assert.equal(await driver.findElement(By.id("field_name")).getAttribute("value"), "Selenium Edited");
        assert.equal(await driver.findElement(By.id("field_balance")).getAttribute("value"), "0");
        assert.equal(await driver.findElement(By.id("field_repS")).getAttribute("value"), "500");
        assert.equal(await driver.findElement(By.id("field_repB")).getAttribute("value"), "1000");
    } finally {
        await driver.quit();
    }
}

async function user_page_delete_test() {
    let driver = await new Builder().forBrowser("chrome").build();

    try {
        await driver.get("http://localhost:8080/user.html?selenium_autogen");

        await driver.findElement(By.id("user_delete")).click();
        await driver.wait(until.urlMatches(/.*?index.html$/), 1000);
    } finally {
        await driver.quit();
    }
}


await index_page_add_user_test();
await user_page_open_test();
await user_page_return_test();
await user_page_data_test();
await user_page_edit_test();
await user_page_delete_test();
